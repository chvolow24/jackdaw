# Jackdaw (WIP)
A free, open-source, keyboard-focused digital audio workstation (DAW). Written in C, using SDL (https://libsdl.org/).

<!-- <img src="readme_imgs/main_new_short.gif" width="80%" /> -->
<!-- ![main](https://charlie-volow.com/assets/random_inputs.gif) -->
<!-- *Jackdaw handling random user inputs* -->
<!-- ![main_gif](https://jackdaw-audio.net/static/readme_imgs/main_new_short.gif) -->
<img src="https://charlie-volow.com/assets/random_inputs.gif" width="50%">


## Table of Contents
1. [Disclaimer](#disclaimer)
2. [Compatibility](#os-compatibility)
3. [Dependencies](#dependencies)
4. [Installation](#installation)
5. [Keyboard command shorthand](#keyboard-command-shorthand)
6. [Quickstart (getting comfortable)](#quickstart-getting-comfortable) 
7. [User manual](#user-manual)
8. [Command reference](#command-reference)

## Disclaimer

Jackdaw is a work in progress and has not been officially "released." What's available here is surprisingly powerful, fun to use, and can definitely be used to make music, but I do not guarantee that everything will work perfectly or as expected.

### Privacy

Jackdaw collects no data and does not connect to the internet. Session logs are stored in temporary files on disk, but these are not visible to anyone unless you choose to share them.

### Use of AI

In case this matters to you: AI has for the most part **not** been used to make Jackdaw. I would estimate that about 200 lines of code, out of ~67k total (0.3%) were substantially generated by AI.

## OS compatibility

Jackdaw is compatible with macOS and Linux. 

Jackdaw currently depends on POSIX system APIs for threading and synchronization, directory navigation, timing, and inter-process communication.

## Dependencies

Jackdaw depends on the following libraries:
- [SDL2](https://libsdl.org/) for:
  - graphics and window management
  - event handling
  - audio I/O
  - misc other platform abstractions
- [SDL2_ttf](https://wiki.libsdl.org/SDL2_ttf/FrontPage) for text rendering
- [PortMidi](https://github.com/PortMidi/portmidi) for MIDI I/O

Each dependency is included as a submodule.

## Installation

Currently, the only way to install Jackdaw is to build it from the source code:

```console
$ git clone --recurse-submodules https://github.com/chvolow24/jackdaw.git
$ cd jackdaw
$ make
```

`make` will first attempt to build each of the (included) dependencies, and will then compile jackdaw's source code and construct the `jackdaw` binary in the root directory of the project.

The dependencies are built locally (i.e., nothing will be installed on your system) and statically linked.

`make clean` cleans all of Jackdaw's build objects, but leaves the dependencies in place.

`make cleanall` cleans all of the dependency build objects as well.

`make debug` builds a debug version of Jackdaw.

PortMidi uses CMake for its build process, and SDL and SDL_ttf use GNU Autotools, so both are required for `make` to execute successfully. For its part, Jackdaw just uses GNU Make.

## Keyboard command shorthand

Although the mouse can be used for almost everything, Jackdaw is built around keyboard commands. Here are some examples of keyboard commands you'll see written in the application and in this documentation: 

<kbd>n</kbd>......................................press the 'n' key<br>
<kbd>p</kbd>......................................press the 'p' key<br>
<kbd>C-s</kbd>...................................hold down 'command' OR 'ctrl', and press the 's' key<br>
<kbd>A-t</kbd>....................................hold down 'alt' OR 'option' and press the 't' key<br>
<kbd>C-S-o</kbd>.................................hold down 'command' OR 'ctrl', AND 'shift', and press the 'o' key<br>
<kbd>S-\<ret\></kbd>..............................hold down 'shift' and press the 'return' or 'enter' key<br>

When a hyphen is present (as in <kbd>C-s</kbd>) it means you need to hold down one or more modifier key before striking the final key to invoke the command.

Capital <kbd>C</kbd> stands for the "Command" OR "Control" key. Jackdaw does not distinguish between these two keys.<br>
Capital <kbd>S</kbd> stands for the "Shift" key.<br>
Capital <kbd>A</kbd> stands for the "Alt" or "Option" key. (Again, no distinction is made)<br>
Capital <kbd>K</kbd> indicates that you must hold down the 'K' key, which is used as a modifier in very specific circumstances.

So, <kbd>C-S-o</kbd> means hold down the control (or command) key and the shift key, and then press 'o'.

Most of the final keys are named by a letter or number, except for these:<br>
<kbd>\<ret\></kbd> means 'return' or 'enter'<br>
<kbd>\<tab\></kbd> means 'tab'<br>
<kbd>\<spc\></kbd> is the spacebar<br>
<kbd>\<del\></kbd> is the 'delete' or 'backspace' key (no distinction)<br>
<kbd>\<up\></kbd>, <kbd>\<down\></kbd>, <kbd>\<left\></kbd>, and <kbd>\<right\></kbd> are the arrow keys<br>

This will all be familiar to emacs users, and hopefully not too painful for everyone else.


## Quickstart (getting comfortable)

This section is a brief tutorial meant to familiarize you with the most basic and frequently-used operations in jackdaw. From there, you can reference the [user manual](#user-manual) to learn about the other things you can do in the program.

### 1. Setting the track input

When you open a fresh Jackdaw session, one track is created automatically. The track input will be set to the default system audio input device, but you can **change the current track input** if you like with <kbd>C-S-i</kbd> (ctrl-shift-i or cmd-shift-i). A list of available input devices will appear. Use <kbd>n</kbd> (for 'next') to go to the next item in the list, and <kbd>p</kbd> (for 'previous') to go to the previous. (These keys will be used a lot). Hit <kbd>\<ret\></kbd> to choose the currently-highlighted device.


> [!TIP]
> <kbd>n</kbd> and <kbd>p</kbd> are used globally for "next" and "previous", or "down" and "up". The <kbd>f</kbd> and <kbd>d</kbd> keys are mapped to all the same commands, and can be used instead if you prefer them.


### 2. Recording some audio

Once you have selected an appropriate audio input device, you can **start recording audio** into jackdaw with <kbd>r</kbd>. After making some noise at your computer or microphone, **stop recording** with <kbd>r</kbd>.

<img src="https://jackdaw-audio.net/static/sync_gifs/record2.gif" width="80%" />


### 3. Playback

You should now see a clip on your timeline, with an audio waveform representing the audio you just recorded. You can rewind over the clip, pause, and play it back with the <kbd>j</kbd> (rewind) <kbd>k</kbd> (pause) and <kbd>l</kbd> (play) keys.

#### j k l : Rewind, Pause, Play

If you tap <kbd>l</kbd> or <kbd>j</kbd> multiple times, the playback speed will double. 

**These are jackdaw's most important key commands!**

### 4. Multi-track audio

Let's **add a track** or two. Let's also assume that you don't know the keyboard command to do so.

Hit the slash key (<kbd>/</kbd>) to open the **command lookup**. Start typing "add track", and you should see the list of available commands narrow. Hit <kbd>\<tab\></kbd> to move down the list, and <kbd>S-\<tab\></kbd> to move up.

You'll notice that the keyboard shortcuts for each command are listed on the right. Note that **Add track** is bound to <kbd>C-t</kbd>.

For now, select that line and hit <kbd>\<ret\></kbd> (or "Enter") to invoke the command and add a track.

Now that you know the keyboard command, try that instead.

(Hold down <kbd>cmd</kbd> or <kbd>ctrl</kbd> and hit <kbd>t</kbd>).

You can again use the <kbd>n</kbd> and <kbd>p</kbd> keys to **move the track selector** up and down. Try rewinding back to the beginning of the recording you made (<kbd>j</kbd> to rewind, <kbd>k</kbd> to pause), selecting a different track, and recording some new audio.

<img src="https://jackdaw-audio.net/static/sync_gifs/record_other_track2.gif" width="80%" />

### 5. Exporting a .wav file

Now that you've created some multi-track audio, you might want to export it to a wav file to show your friends. 

First you'll need to place "in" and "out" marks on your timeline with <kbd>i</kbd> and <kbd>o</kbd>, which will place the mark at the current playhead position. You'll need to play/rewind/pause a bit (<kbd>j</kbd><kbd>k</kbd><kbd>l</kbd>! <kbd>j</kbd><kbd>k</kbd><kbd>l</kbd>!) to get the playhead positioned correctly to set the marks. To get more precise placement, you can hold down <kbd>k-j</kbd> to **rewind slow** or <kbd>k-l</kbd> to **play slow**. Once you have placed 'in' and 'out' marks such that some portion of the timeline is visibly marked, you can export to a wav file with <kbd>S-w</kbd>.

You will be prompted to type a file name. Hit <kbd>tab</kbd> or <kbd>\<ret\></kbd> to apply the current name, and move down to the directory navigation pane. Then, use <kbd>n</kbd> and <kbd>p</kbd> to navigate through the filesystem to the directory where you want to save the file. Subdirectories are displayed in green. The double dots ("..") will bring you up one directory. Finally, use <kbd>\<tab\></kbd> to move down to the "Save" button, and then <kbd>\<ret\></kbd> to save the file with the current name, in the currently open directory. (Or, use <kbd>C-\<ret\></kbd> to "submit the form" and save the file.)

<img src="https://jackdaw-audio.net/static/sync_gifs/export_wav2.gif" width="80%" />

### 6. Saving your project

If you want to revisit this project later, you can save a project file (`.jdaw`) with `C-s`.

You will be prompted to enter a project name (which must include the `.jdaw` extension), and can then hit <kbd>\<ret\></kbd> or <kbd>\<tab\></kbd> to move down to the directory navigation pane. Navigate to the location at which you want to save the project (with <kbd>n</kbd> and <kbd>p</kbd>), and submit the form with <kbd>\<tab\></kbd> and then <kbd>\<ret\></kbd>to complete saving.

# User manual

1. [Command lookup](#command-lookup)
2. [Menus](#menus)
3. [Timeline navigation and playback](#timeline-navigation-and-playback)
    1. [Playback](#playback)
    2. [Scrubbing / play speed](#scrubbing--play-speed)
	3. [Translate / zoom](#translate--zoom)
	4. [Move playhead](#move-playhead)
	5. [Track selector](#track-selector)
	6. [Cursor](#cursor)
	7. [Marks and jump-to](#marks-and-jump-to)
	8. [Scrolling](#scrolling)
	9. [Loop playback](#loop-playback)
4. [Recording](#recording)
5. [Tracks](#tracks)
    1. [Activating / deactivating tracks](#activating--deactivating-tracks)
	2. [Muting / soloing](#muting--soloing)
	3. [Adjusting volume / pan](#adjusting-volume--pan)
	4. [Setting track input](#setting-track-input)
	5. [Reordering tracks](#reordering-tracks)
	6. [Minimizing tracks](#minimizing-tracks)
	7. [Renaming tracks](#renaming-tracks)
        1. [Editing text](#editing-text)
6. [Clips](#clips)
    1. ["Clips" vs "Clip references"](#technical-note-clips-vs-clip-references)
	2. ["Grabbing" and moving clips](#grabbing-and-moving-clips)
	3. [Clip overlap](#clip-overlap)
	4. [Cutting clips](#cutting-clips)
	5. [Renaming clips](#renaming-clips)
7. [Click tracks](#click-tracks)
    1. [Time signatures](#time-signatures)
	2. [Click track segments](#click-track-segments)
	3. ["Freeze" click track](#freeze-click-track)
	3. [Metronome](#metronome)
	4. [Grid navigation](#grid-navigation)
	5. [Set tempo](#set-tempo)
8. [Source mode](#sample-mode--source-mode)
9. [Project navigation / multiple timelines](#project-navigation--multiple-timelines)
10. [Opening and saving files](#opening-and-saving-files)
11. [Track effects](#track-effects)
    1. [Adding, ordering, and removing effects](#adding-ordering-and-removing-effects)
	2. [EQ](#eq)
	3. [FIR Filter](#fir-filter)
	4. [Delay line](#delay-line)
	5. [Saturation](#saturation)
	6. [Compressor](#compressor)
12. [Automation](#automation)
    1. [Adding keyframes with the mouse](#adding-keyframes-with-the-mouse)
	2. [Writing (adding keyframes automatically)](#writing-adding-keyframes-automatically)
	3. [Deleting keyframes](#deleting-keyframes)
13. [MIDI](#midi)
    1.  [Basics (I/O, MIDI Clips)](#basics-io-midi-clips)
    2.  [Synthesizer](#synthesizer)
    3.  [QWERTY piano emulator](#qwerty-piano-emulator)
    4.  [Piano roll](#piano-roll)
    5.  [MIDI controllers](#midi-controllers)
    6.  [MIDI files](#midi-files)
    7.  [JLily (LilyPond)](#jlily-lilypond)
13. [Undo / redo](#undo--redo)
14. [Special audio inputs](#special-audio-inputs)
    1. [Jackdaw out](#jackdaw-out)
	2. [Pure data](#pure-data)
15. [API](#api)
    1. [Starting the server](#starting-the-server)
	2. [Request syntax](#request-syntax)

## Command lookup

Jackdaw's user interface is built around keyboard commands, but you don't need to memorize them. Hit the slash key (<kbd>/</kbd>) to open an autocomplete dropdown list of available commands. You can start typing one or more keywords to see a list of matching commands. Use <kbd>\<tab\></kbd> to navigate down through the list, <kbd>S-\<tab\></kbd> to navigate up, <kbd>\<ret\></kbd> to select an item, and <kbd>\<esc\></kbd> to escape without selecting an item.

Each entry in the list includes the display name of the command on the left, and the bound keyboard command on the right. (See "[Keyboard command shorthand](#keyboard-command-shorthand)" above if these confuse you.)

<img src="https://jackdaw-audio.net/static/sync_gifs/function_lookup.gif" width="80%" />

## Menus

You can also summon a menu with a list of available actions organized by category with <kbd>C-m</kbd> or <kbd>C-h</kbd> ("m" for menu, "h" for help). Navigate with <kbd>n</kbd>, <kbd>p</kbd> to move the selection up or down, and <kbd>j</kbd> and <kbd>l</kbd> to move left and right between columns. Then use <kbd>\<ret\></kbd> to select. Use <kbd>m</kbd> (or <kbd>h</kbd> or <kbd>\<esc\></kbd>) to dismiss the menu.

You can also summon the menu by clicking on the "hamburger" in the upper-right corner of the window.

## Timeline navigation and playback

Timeline navigation commands are all within easy reach of your right hand:

### Playback
<kbd>j</kbd> : **rewind** (multiple taps to rewind fast)<br>
<kbd>k</kbd> : **pause**<br>
<kbd>l</kbd> : **play** (multiple taps to play fast)<br>

### Scrubbing / play speed

You can use the mousewheel or trackpad to achieve finer control over playback.

> [!NOTE]
> These actions work best on trackpads with multi-finger touch detection, like those on macbooks.

<kbd>S-\<scroll horizontal\></kbd> : **scrub (fine)**<br>
<kbd>C-S-\<scroll horizontal\></kbd> : **scrub (coarse)**<br>

<kbd>S-\<scroll vertical\></kbd> : **adjust speed (fine)**<br>
<kbd>C-S-\<scroll vertical\></kbd> : **adjust speed (coarse)**<br>


### Translate / zoom
<kbd>h</kbd> : **move view left**<br>
<kbd>;</kbd> : **move view right**<br>
<kbd>,</kbd> : **zoom out**<br>
<kbd>.</kbd> : **zoom in**<br>

<kbd>C-\<scroll\></kbd> : **zoom in or out**<br>

These zoom commands will center on the current playhead position. Using the mousewheel/trackpad to zoom will center the zoom on the current mouse position. 

### Move playhead
<kbd>[</kbd> : **move playhead left**<br>
<kbd>]</kbd> : **move playhead right**<br>

<kbd>S-]</kbd> : **move playhead left (slow)**<br>
<kbd>S-[</kbd> : **move playhead right (slow)**<br>

Press and hold these commands to move the playhead around without playing back audio. The amount moved is relative to the window width, not a fixed time amount (unlike playback/rewind).

### Track selector

The *track selector* is how you indicate which track you are doing things to. The track console (left side) is highlighted in orange if the track is currently selected.

<kbd>n</kbd> : **move selector down** (next track)<br>
<kbd>p</kbd> : **move selector up** (previous track)<br>
<!-- <kbd>\<ret\></kbd> : **activate/deactivate current track**<br> -->

<!-- **Activating** tracks (as opposed to merely *selecting* them) is a way to do things that might normally be done to only one track to multiple tracks at once. For example, if you activate tracks 1, 2, and 3, and then hit <kbd>r</kbd> to record, you will wind up with *three* clips (more accurately, clip references) -- one on each track -- instead of one. The numerical keys (<kbd>1</kbd>, <kbd>2</kbd>, <kbd>3</kbd> etc.) can be used to quickly activate or deactivate tracks 1-9 without using the track selector. -->

### Cursor

The "cursor" (as in "[do thing] at cursor") is the location on the currently selected track under the current playhead position. So, *"grab clip at cursor"* means "grab the top clip on the currently selected track that intersects with the current playhead position."

Keystrokes that move the track selector or move the playhead can therefore also be thought of as ways to move the cursor:

<kbd>n</kbd> or <kbd>f</kbd> : **cursor down**<br>
<kbd>p</kbd> or <kbd>d</kbd> : **cursor up**<br>
<kbd>j</kbd> : **cursor left**<br>
<kbd>l</kbd> : **cursor right**</br>

The cursor concept is critical to how you interact with Jackdaw.

### Marks and jump-to

"In" and "out" marks can be set to mark a range on the current timeline. They also be used as handy jump-to points.

You can also jump to the start of the timeline (t=00:00:00000) with <kbd>S-u</kbd>, which is helpful if you get lost. 

<kbd>i</kbd> : **mark in**<br>
<kbd>o</kbd> : **mark out**<br>
<kbd>S-i</kbd> : **jump to in mark**<br>
<kbd>S-o</kbd> : **jump to out mark**<br>
<kbd>S-u</kbd> : **jump to t=0**<br>
<kbd>S-j</kbd> : **jump to start of clip at point**
<kbd>S-l</kbd> : **jump to end of clip at point**

### Scrolling

When you move the track selector with <kbd>n</kbd> and <kbd>p</kbd>, the timeline will automatically refocus such that the selected track is visible. You can also scroll through tracks with a mouse or trackpad. Scrolling horizontally translates the timeline in the manner of <kbd>h</kbd> and <kbd>;</kbd>.

Holding <kbd>Cmd</kbd> or <kbd>Ctrl</kbd> and scrolling on the timeline will zoom in or out.


### Loop playback

You can play back a marked section of the timelines (see [section](#marks-and-jump-to) above) in a loop by enabling loop playback.

<kbd>C-8</kbd> : **Enable / disable loop playback**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/loop_playback.gif" width="80%" />

Future versions of jackdaw will include more sophisticated looping mechanisms.

## Recording

<kbd>r</kbd> : **start or stop recording**<br>

When you hit <kbd>r</kbd>, audio recording will begin on all [activated](#activating-deactivating-tracks) tracks, or, if no tracks are activated, on the currently selected track. Clips are created on each of these tracks beginning at the current playhead position. When you stop recording, these clips will be populated with the audio data you just recorded.

You can record from multiple audio devices at once, simply by setting different inputs on different tracks, activating each of those tracks, and hitting <kbd>r</kbd>.

## Tracks

Jackdaw tracks are flexible: they can accept mono or stereo audio clips, or MIDI clips. A Track is just a Track.

<kbd>C-t</kbd> : **add a track**<br>
<kbd>C-\<del\></kbd> : **delete the currently selected track**<br>

### Activating / deactivating tracks

**Activating** tracks (as opposed to merely *selecting* them) is a way to do things certain things to multiple tracks at once. Here are things you can do to multiple tracks at once:

- mute / solo
- adjust volume
- adjust pan
- record audio
- grab clips

<kbd>\<ret\></kbd> : **Activate or deactivate the currently-selected track**<br>
<kbd>`</kbd> : **Activate or deactivate all tracks**<br>

### Muting / soloing

Muted tracks will not be read during playback, or when exporting a `.wav` file.

If any track on the timeline is soloed, only tracks that have been soloed will be read. The `S` button will be red on any un-soloed tracks to indicate that they are effectively muted.

<kbd>m</kbd> : **Mute currently selected track (or active tracks)**<br>
<kbd>s</kbd> : **Solo currently selected track (or active tracks)**<br>

### Adjusting volume / pan

Track volume can be attenuated or boosted. Stereo tracks can be panned to the left or right. The pan implementation is fairly primitive; panning to either side will simply attenuate the opposite channel by an amount proportional to the pan amount.

> [!TIP]
> These key combinations can be held down for continuous adjustment.

<kbd>S--</kbd> : **Volume down (selected or active tracks)**<br>
<kbd>S-=</kbd> : **Volume up (selected or active tracks)**<br>
<kbd>S-9</kbd> : **Pan left (selected or active tracks)**<br>
<kbd>S-0</kbd> : **Pan right (selected or active tracks)**<br>

(Note that the pan adjustment keystrokes are the left and right parens.)

### Setting track input

The track input can be set to any of the available system audio devices (e.g. built-in laptop microphone, external microphone), "Jackdaw out," which uses Jackdaw's audio output as an audio input (for what is sometimes confusingly called "resampling"), Pure data (experimental; described [below](#pure-data)) a connected MIDI device, or the QWERTY piano emulator.

<kbd>C-S-i</kbd> : **Set track input**<br>

### Reordering tracks

If you hold down shift while moving the track selector up or down, the selected track will move with you.

<kbd>S-n</kbd> : **Move selected track down**<br>
<kbd>S-p</kbd> : **Move selected track up**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/move_track.gif" width="80%" />

### Minimizing tracks

<kbd>-</kbd> : **Minimize / expand selected track(s)**<br>

### Renaming tracks

You can rename the selected track with <kbd>C-r</kbd>, or cmd/ctrl + click the track name label box.

<kbd>C-r</kbd> : **Rename selected track**<br>

#### Editing text

Renaming a track or other object will put the program into "text edit mode", in which most keystrokes are read as text input rather than as keycommands. Use <kbd>\<ret\></kbd> to complete your edit and "escape" text edit mode.

There are some very limited additional text editing commands that can be used while a text field is being edited:

<kbd>\<ret\></kbd>, <kbd>\<tab\></kbd>, <kbd>\<esc\></kbd> : **Escape text edit mode (complete edit)**<br>
<kbd>\<del\></kbd> : **Backspace**<br>
<kbd>\<right\></kbd>, <kbd>C-f</kbd> : **Move cursor to the right**<br>
<kbd>\<left\></kbd>, <kbd>C-d</kbd>, <kbd>C-b</kbd> : **Move cursor to the left**<br>
<kbd>C-a</kbd> : **Highlight all text**<br>


### Deleting tracks

<kbd>C-\<del\></kbd> : **Delete the currently-selected track**</br>

## Clips

A clip is a chunk of audio or MIDI data represented on the timeline.

### Technical note: "Clips" vs. "Clip references"

In general, this document and the application itself refer to the rectangles on the timeline that contain audio data as "clips." 

The audio data itself does live in a object called a [`Clip`](https://github.com/chvolow24/jackdaw/blob/ad23433e6a801adc316ae968d0de9c07e174e894/src/project.h#L170), but the information mapping that audio data to a position on the timeline is an object called a "clip reference", type [`ClipRef`](https://github.com/chvolow24/jackdaw/blob/ad23433e6a801adc316ae968d0de9c07e174e894/src/project.h#L151).

A clip can have many clip reference. The audio data associated with the clip is not duplicated; therefore, when copying clips or portions of clips using Source Mode, you are not actually copying any audio data; you are merely creating additional references to the clip.

The blue or green color of any given clip reference on the timeline is not particularly meaningful in this version of jackdaw (0.4) and can be safely ignored.

### "Grabbing" and moving clips

Clips that have been "grabbed" can be deleted or moved around on the timeline.

<kbd>g</kbd> : **Grab clips at cursor(s)**<br>

Using this command will grab any clips that intersect the playhead position on the currently selected track OR all active tracks. If all intersecting clips are already grabbed, the command will un-grab all clips.

A clip can also be "grabbed" with <kbd>C-\<click\></kbd>.

<kbd>C-k</kbd> : **Toggle drag clips**<br>

If clip dragging is enabled, the clips will gently flash, and an indication will appear in the status bar at the bottom of the screen indicating how many clips are currently grabbed.

<img src="https://jackdaw-audio.net/static/sync_gifs/drag_clips.gif" width="80%" />

Moving the track selector will pull all currently-dragging clips along with it.

### Adjusting clip edges

In addition to grabbing and moving clips themselves, you can also grab and move clip edges.

The keyboard commands use `g` (which is bound to `Grab clip at cursor`) as a modifier key, and `j` and `l` for "left" and "right", respectively (analogous to `j` = rewind and `l` = play).

So to grab the left edge, position the cursor over the clip and do `g-j`. To grab the right edge, `g-l`. If dragging is active (`C-k`), moving the playhead will also move the grabbed edges.

<img src="https://jackdaw-audio.net/static/sync_gifs/grab_edge_move.gif" width="80%" />

Arrows are displayed when there's "room" on either side of the clip, i.e. there's audio data beyond the current window.

You can cut a clip and automatically grab both edges of the cut to move the cut position with `g-c` (`Cut clip at cursor and grab edges`):

<img src="https://jackdaw-audio.net/static/sync_gifs/grab_cut_and_drag.gif" width="80%" />

### Clip overlap

Audio from overlapping clips on the same track is simply added; i.e. audio from both clips will be played.

If you need to grab or otherwise alter a clip that is buried under an overlapping clip, you can bring it to the "front" with <kbd>S-z</kbd>

<kbd>S-z</kbd> : **Bring rear clip at cursor to front**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/bring_clip_to_front.gif" width="80%" />

### Cutting clips

<kbd>S-c</kbd> : **Cut clips at cursor**<br>

This will cut any clips on the currently selected track at the current playhead position in two, so that you can independently move or otherwise modify each part.

<img src="https://jackdaw-audio.net/static/sync_gifs/cut_clip.gif" width="80%" />

### Renaming clips

<kbd>C-S-r</kbd> : **Rename clip at cursor**<br>

See <a href = "#editing-text">"Editing text"</a> for more on text edit mode.

## Click tracks

You can add click tracks to your project to create a "grid."

<kbd>C-S-t</kbd> : **Add click track**<br>

Click tracks fundamentally comprise a series of one or more *segments*, each of which can have its own tempo and time signature. A lot of music will only require a single click track and single time signature, but jackdaw allows you to create many click tracks, each of which can have many segments.

<kbd>S-t</kbd> : **Edit click track**<br>

Edit the click track and segment at cursor with <kbd>S-t</kbd>, or by clicking the pencil icon on the left of the track.

<img src="https://jackdaw-audio.net/static/sync_gifs/click_track_add.gif" width="80%" />

Then, <kbd>\<tab\></kbd> through the fields to modify any of the track parameters and "Submit" to confirm your changes to the time signature and tempo. (Changes to the track name do not need to be submitted.

### Time signatures

Jackdaw doesn't use conventional time signatures because they're confusing and limited. Instead, you specify first the number of "beats" (coarse divisions of a measure) and then the number of subdivisions in each of those beats. So a 4/4 time signature, which has 4 beats, could be defined as 4 + 4 + 4 + 4, or 2 + 2 + 2 + 2. 6/8 typically has *two* beats, and would be defined as 3 + 3.

It is therefore very easy to define additive meters, like the Bulgarian Gankino horo (4 + 3 + 4):

<img src="https://jackdaw-audio.net/static/sync_gifs/additive_meter.gif" width="80%" />


### Click track segments

If you need to change tempo or time signature partway through a song, you can do so by adding new click track segments.

To do so, **cut** the click track with <kbd>S-c</kbd>. (Note that this is the same command you would use to cut a clip, but if a click track is selected, it will cut the click track instead.

<img src="https://jackdaw-audio.net/static/sync_gifs/cut_click_track.gif" width="80%" />

Now, you can modify each of the segments individually. When editing a segment, you can specify whether you want the end position to remain fixed, or the number of measures. If the number of measures is fixed, the end position of the segment may move, and all the segments to the right will move with it.

You can click and drag the boundaries between click track segments to reposition them, and you can delete a segment with <kbd>\<del\></kbd>

<img src="https://jackdaw-audio.net/static/sync_gifs/edit_segment_bounds.gif" width="80%" />

While dragging, the segment boundary will automatically snap to the previous segment's subdivisions. Hold <kbd>\<shift\></kbd> to disable the snapping.

### "Freeze" click track

Jackdaw provides a lot of flexibility that you'll almost never need with respect to click track placement; you can create a bunch of click tracks and move them up and down the timeline to your heart's content. Placement is not strictly cosmetic: each Track is "governed" by the click track positioned nearest above it on the timeline, so when you need to do grid-related things on a track (e.g. jumping to the next beat position with `C-l`, or adding notes in the piano roll), you can control *which* grid you're using.

The downside of this design is that if you have a bunch of tracks and scroll down, the click track you're using may no longer be visible.

To solve this, you can now "freeze" a click track at the top of the timeline view, and it will remain fixed there regardless of how you scroll. You do this simply by moving (`S-p`) the click track "all the way up":

<img src="https://jackdaw-audio.net/static/sync_gifs//freeze_click_track.gif" width="80%">

(Note that the frozen click track covers over the timecode view.)

You "unfreeze" the click track by selecting it (repeat `p` or `d` until you're "all the way up") and moving it down (`S-n`):


### Metronome

Each click track has a metronome which is on by default. You can mute the click track exactly as you would an audio track (select the track and then <kbd>m</kbd>, and adjust the volume of the metronome exactly as you would adjust the volume of an audio track (<kbd>S--</kbd> and <kbd>S-=</kbd>).

You can also lightly customize the metronome by setting which sound plays on each of the following:

1. measure boundaries
2. beat boundaries
3. even beats (2 & 4 in 4/4) only
4. subdivisions (e.g. eighths)

These options can be found in the second tab of the click track settings tab view (select a click track (`n` and `p`) and then `S-t` to open the tabview, and `S-l` to tab right).

### Grid navigation

Click tracks can be moved up and down on the timeline exactly like audio tracks: with <kbd>S-n</kbd> and <kbd>S-p</kbd>.

All of the audio tracks directly *below* a given click track are governed by that click track. In the current version of jackdaw (v0.5.0) this is only relevant when using the following navigation commands:

<kbd>C-j</kbd> : **Go to previous beat**<br>
<kbd>C-l</kbd> : **Go to next beat**<br>

<kbd>C-S-j</kbd> : **Go to previous subdivision**<br>
<kbd>C-S-k</kbd> : **Go to next subdivision**<br>

<kbd>A-S-j</kbd> : **Go to previous measure**<br>
<kbd>A-S-k</kbd> : **Go to next measure**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/click_track_navigation.gif" width="80%" />

### Set tempo

You can quickly set the tempo of the click segment at cursor with <kbd>t</kbd>

You can also Ctrl- or Cmd- click the click track segment and drag it to set the tempo.

Changing the tempo of click track segment moves clips, notes, and automation keyframes for all tracks using that click track.

<img src="https://jackdaw-audio.net/static/sync_gifs/click_track_tempo_change.gif" width="80%">

If you want to edit a click track without moving these objects, you can first move the click track to the bottom of the timeline, or temporarily insert another click track below the one you wish to edit. I recognize this may not be ideal, and may refine the feature later.

## Source mode

Jackdaw provides an interface for extracting samples from an audio clip, and dropping [references](#technical-note-clips-vs-clip-references) to those samples in your timeline.

<kbd>C-1</kbd> : **Load clip at cursor to source**<br>

If there is a clip at cursor, this command will load that clip to the source area near the top of the window.

<kbd>S-1</kbd> : **Activate or deactivate source mode**<br>

In source, you can play back, scrub through, and set marks in the clip that has been loaded into the source area. The controls -- including zooming in and out, or moving the display window -- are identical as in timeline mode.

The marks you set in source mode will determine which portion of the clip is dropped into your timeline when you:

<kbd>b</kbd> : **Drop clip from source**<br>

This creates a new clip reference on your timeline, at the current playhead position, on the currently-selected track.

<img src="https://jackdaw-audio.net/static/sync_gifs/source_mode.gif" width="80%" />

Every time you drop a clip into a timeline from the source area, jackdaw will save information about that drop. If you then drop something else into your timeline (either a different clip or the same clip with different marks) with <kbd>b</kbd>, you will be able to once again drop the previously-dropped clip with <kbd>v</kbd>. Another new drop will move the clip stored at <kbd>v</kbd> to <kbd>c</kbd>, so that you have unique clips that you can drop into your timeline with any of those three keys. Etc. for subsequent drops and <kbd>x</kbd> and <kbd>z</kbd>.

<kbd>b</kbd> : **Drop clip from source**<br>
<kbd>v</kbd> : **Drop previous clip (-1) from source**<br>
<kbd>c</kbd> : **Drop previous clip (-2) from source**<br>
<kbd>x</kbd> : **Drop previous clip (-3) from source**<br>
<kbd>z</kbd> : **Drop previous clip (-4) from source**<br>

## Project navigation / multiple timelines

Jackdaw provides a way to use multiple workspaces in a single project. Each of these is a "timeline," which is just a collection of tracks with associated clips. 

<kbd>A-t</kbd> : **Create new timeline**<br>
<kbd>A-l</kbd> : **Go to next timeline**<br>
<kbd>A-j</kbd> : **Go to previous timeline**<br>
<kbd>A-<del></kbd> : **Delete current timeline**<br>

When creating a new timeline, you will be prompted to enter a name. Type the name, hit <kbd>\<tab\></kbd> or <kbd>\<ret\></kbd> to move to the "Create" button, and then <kbd>\<ret\></kbd> again to complete naming the timeline.

## Opening and Saving files

### Opening files

Jackdaw knows how to open `.wav`, `.jdaw` (project), `.jsynth` (synth preset), and `.mid` (MIDI) files. You can open files in one of three ways:

1. with <kbd>C-o</kbd> (`Open file`)
2. drag-and-drop a file onto the Jackdaw window
3. on the command line

<kbd>C-o</kbd> : **Open a file**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/openwav.gif" width="80%" />

If a `.wav` file is opened, it will be loaded as a clip to the currently-selected track, starting at the current playhead position. If a `.jdaw` file is opened, the current project will be closed and replaced with the project saved in the `.jdaw` file (this action cannot be undone, so be careful). Synth presets (`.jsynth`) are loaded to the currently-selected track's synth (this action *can* be undone).

To open a file on the command line, simply pass the filepath to the program:

```console
$ jackdaw PATH_TO_FILE
```

### Saving a project

A `.jdaw` file stores a jackdaw project, including all of its timelines, tracks, clips, effects, automations, etc.

<kbd>C-s</kbd> : **Save project as**<br>

You will be prompted first to edit the current project file name. The file extension **must** be `.jdaw` or `.JDAW`; the program will encourage you to fix this if you make a mistake. Hit <kbd>\<tab\></kbd> or <kbd>\<ret\></kbd> to finish editing the name. Now, the directory navigation pane will be active, and you can use <kbd>n</kbd>, <kbd>p</kbd>, and <kbd>\<ret\></kbd> to navigate through the filesystem to the directory where you would like to save the file. When satisfied, type <kbd>\<tab\></kbd> and then <kbd>\<ret\></kbd> (or just <kbd>C-\<ret\></kbd> to save.)

The `.jdaw` file format is described in the `jdaw_filespec` directory.

<img src="https://jackdaw-audio.net/static/sync_gifs/save_project.gif" width="80%" />

## Track effects

### Adding, ordering, and removing effects

Up to 16 effects can be added to a given track. 

<kbd>S-e</kbd> : **Add effect to track**<br>
<kbd>S-t</kbd> : **Open track effects**<br>

The effects are displayed in a "tab view." The order in which the effects are processed is determined by the order of the tabs.

#### Tab view navigation

You can navigate the tab view with the mouse or with the keyboard:

<kbd>\<tab\></kbd> : **Cycle through page elements**<br>
<kbd>S-\<tab\></kbd> : **Cycle through page elements in reverse**<br>
<kbd>h</kbd> : **Nudge slider left**<br>
<kbd>;</kbd> : **Nudge slider right**<br>
<kbd>\<ret\></kbd> : **Select / toggle / cycle current element**<br>

You can also navigate to other tabs:

<kbd>S-j</kbd> : **Tab left**<br>
<kbd>S-l</kbd> : **Tab right**<br>

And reorder the tabs:

<kbd>C-S-j</kbd> : **Move current tab left**<br>
<kbd>C-S-l</kbd> : **Move current tab right**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/add_reorder_effects.gif" width="80%" />

You can also click the tabs, and click and drag to reorder them.

To remove an effect, simply hit `del` or `backspace` while the effect is selected in the tab view. Associated automation tracks will be removed as well, and will be reinstated if the deletion is undone.

### EQ

The EQ effect contains 6 configurable filters. Each can be set to one of the following types:

1. Low-shelf / Highpass
2. Peak / Notch
3. High-shelf / Lowpass

The leftmost filter is low-shelf by default, the rightmost is high-shelf, and the others are peak/notch. Any given filter can be changed to any type by clicking the symbols representing the filter types.

The filter frequencies and amplitudes are modified by clicking and dragging the nodes on the spectral display:

<img src="https://jackdaw-audio.net/static/sync_gifs/eq_adj_filters.gif" width="80%" />

The bandwidth of a peak-notch filter can be adjusted by holding down `cmd` or `ctrl` and dragging the mouse up or down.

Each filter is a biquad infinite impulse response (IIR) filter. The low-shelf/high-shelf filters are based on the continuous-time Butterworth filter, and the peak/notch filters are implemented based on Joshua D. Reiss, ["Design of Audio Parametric Equalizer Filters
Directly in the Digital Domain", IEEE TRANSACTIONS ON AUDIO, SPEECH, AND LANGUAGE PROCESSING, VOL. 19, NO. 6, AUGUST 2011](https://www.eecs.qmul.ac.uk/~josh/documents/2011/Reiss-2011-TASLP-ParametricEqualisers.pdf).


### FIR filter

The FIR ("finite impulse response") filter is an FFT-based "[windowed-sinc](https://www.analog.com/media/en/technical-documentation/dsp-book/dsp_book_Ch16.pdf)" filter. It can be configured to have a low-pass, high-pass, band-pass, or band-cut frequency response. The cutoff frequency and bandwidth are adjustable parameters, as is the length of the impulse response. This last parameter affects the "steepness" of the frequency response curve. 

> [!NOTE]
> This is a computationally expensive effect.

The frequency response of the filter is shown. When the filter is active, and playback is occurring, the frequency domain of the filtered audio track is also shown.

<img src="https://jackdaw-audio.net/static/sync_gifs/fir_filter.gif" width="80%" />


### Delay line

The delay line has three parameters: time, amplitude, and "stereo offset." The delay time is the amount of time between echoes, and the amplitude is the relative amplitude of each successive echo. "Stereo offset" delays playback of the delay line buffer in the left channel by some proportion of the delay line length, expressed as a value between 0.0 and 1.0. In other words, with a nonzero stereo offset, you will hear echoes at different times in the left and right channels.

### Saturation

The saturation effect does simple sample-wise wave shaping. There are two types available: the common `tanh` function, and and exponential function that behaves similarly. Though often indistinguishable, the exponential function produces more high-frequency content than `tanh`, which is a noticeable difference when the input signal is low-passed.

The `gain` parameter simply adjust the gain of the input signal (resulting in more wave shaping), and `gain compensation` will attenuate the output to more closely approximate the input. The `symmetry` parameter can be adjusted to get brighter-sounding distortion.

An active saturation effect with zero gain placed at the end of a track's effect chain is a good way to prevent digital clipping.

### Compressor

A standard digital peak-sensing compressor. Details of dynamic range compression are not discussed here.

In the visualization, the x position of the blue dot represents the current amplitude envelope value, and the y position represents the corresponding output amplitude (before make-up gain is applied). The color gradient reflects the amount of gain reduction currently applied by the compressor.

<img src="https://jackdaw-audio.net/static/sync_gifs/comp.gif" width="80%" />

## Automation

Mix automation is available for the track volume and pan, as well as most parameters related to any effects currently applied to the track, and all synth parameters (if a synth has been opened on the track).

<kbd>C-a</kbd> : **Add automation to track**<br>
<kbd>a</kbd> : **Show / hide track automations**<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/add_automation.gif" width="80%" />

(Note that <kbd>n</kbd> and <kbd>p</kbd> (or <kbd>f</kbd> and <kbd>d</kbd>) can be used to cycle through the radio button options, and <kbd>\<tab\></kbd> and <kbd>S-\<tab\></kbd> can be used to move between the selector and the "add" button. The mouse is available but optional.)

### Adding keyframes with the mouse

Use <kbd>C-\<click\></kbd> to add a keyframe to an automation track. You can then drag the keyframe to the desired position. If you release cmd/ctrl and hold shift, the keyframe will will snap to the same vertical position as the previous keyframe, creating a flat segment. If you hold cmd or ctrl AND shift, the keyframe will snap to the position immediately after the previous keyframe, creating a near-vertical segment.

<img src="https://jackdaw-audio.net/static/sync_gifs/insert_keyframes.gif" width="80%" />

### Writing (adding keyframes automatically)

While an automation is in "write" mode, any changes to the automated parameter will be recorded on the automation track during playback. Any existing keyframes intersecting with the newly-written portion will be overwritten.

The easiest way to accomplish this is to "record" on the automation track exactly as you would on an audio track: navigate the cursor to the automation track with <kbd>n</kbd> and <kbd>p</kbd> (or <kbd>f</kbd> and <kbd>d</kbd>) and hit <kbd>r</kbd> to start recording. Hit <kbd>r</kbd> again to stop.

<kbd>r</kbd> : **Start / stop recording automation** (when automation track selected)<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/automation_write.gif" width="80%" />

### Deleting keyframes

When an automation track is selected, you can delete a range of keyframes by marking (with <kbd>i</kbd> and <kbd>o</kbd>) a section of the timeline and hitting <kbd>del</kbd>.

<kbd>del</kbd> : **Delete keyframes in->out** (when automation track selected)<br>

<img src="https://jackdaw-audio.net/static/sync_gifs/delete_keyframes.gif" width="80%" />

## MIDI

So far, the MIDI functionality in Jackdaw can only be used to control the builtin synthesizer. But it'll do more in the future, and the builtin synth is more powerful than you might expect. With the QWERTY piano emulator, you can start making your own sounds in Jackdaw immediately, without an external device.

### Basics (I/O, MIDI Clips)

Tracks in Jackdaw are not "audio tracks" or "MIDI tracks" -- they are just Tracks. You can record MIDI data onto a track exactly like you would record audio: first, select one of the MIDI devices from list of available inputs (`C-S-i`, or click the track input box); then, hit `r` to start recording. A pink MIDI clip will appear on the track, and any notes you play on the MIDI device will be recorded to that clip. Hit `r` again to stop recording.

<img src="https://jackdaw-audio.net/static/sync_gifs/record_midi.gif" width="80%">

### Synthesizer

Each Track has its own synth, and MIDI is played back through the synth by default. The synth is opened with `S-s`. 

(There's a `Track set MIDI out` command, which could be used for other instruments or external devices in the future; for now it's useless.)

#### Oscillators

Jackdaw's synthesizer has four "base oscillators" with selectable waveform types (sine, triangle, square, saw). Each of the base oscillators can be replicated in up to 7 unison voices, which can be detuned and spread across the stereo field. The base oscillators can be tuned (octave, coarse, and fine tuning) individually, or set to a fixed frequency.

By default, the four base oscillators are added together. However, you can also set one oscillator to modulate the frequency or amplitude of another. Modulation can be used to create new timbres or, when the modulator is set to a low frequency, to create vibrato (frequency) or tremolo (amplitude). When a given base oscillator is being modulated by another, the appropriate `Is carrier` red status light will be lit.

<img width="80%" src="https://jackdaw-audio.net/static/sync_gifs/synth_mod.gif">

By default, the phase of all oscillators (i.e. all of the base oscillators and their unison voices) will be reset when a new note is triggered. You can turn this off by unchecking the `Sync phase` toggle. In general, *not* syncing phase is preferable for more heterogenous sounds, like orchestral strings. It introduces an element of chaos into the sound, and is often undesirable for things like bass instruments, where phase differences can unexpectedly and dramatically mute or amplify a sound.


#### Amplitude envelope

The synth uses a conventional ADSR envelope. The `Ramp exponent` parameter sets an exponent value for each ramp; as that value increases past 1.0, the shape of the decay and release ramps change gradually from something that looks like "\\" to something that looks closer to "L". In other words, a ramp exponent of 1.0 gives a linear decay, 2.0 gives quadratic decay, etc. 

#### Noise

White noise can be introduced into the sound and controlled by its own amplitude envelope. Even if the noise envelope is enabled, the noise sound still passes through the main amplitude envelope and the filter.

#### Filter

The filter is a one-pole resonant lowpass Chebyshev filter. The `Base cutoff` parameter sets a *lower bound* for the filter cutoff frequency. The `Key tracking` parameter adds a multiple of the current note frequency to the base cutoff. `Velocity tracking` *attenuates* (brings down) the cutoff frequency when the note has less-than-full velocity, more so for higher values of the parameter. (So, bring this slider all the way up if you want maximum expressivity). `Env amount` *adds* to the cutoff frequency an amount that changes dynamically with the filter's envelope.

The filter cutoff tracks the amplitude envelope by default, but can be given its own ADSR shape when `Use amp env` is unchecked. The effect is most obvious when the amp envelope has a short attack, and the filter envelope is given a longer attack, producing a "wah" sound.

#### Effects

When effects are added directly to the synth (instead of to its parent Track), they are heard even when the synth is being monitored directly, i.e., while you are playing. Delay lines and saturation sound excellent on a synth.

The effects can be re-ordered, deleted, and undeleted exactly like track effects. They are included when a synth preset is saved. Unlike track effects, you can't apply automation to synth effect parameters.

#### Polyphony

The synth can be used polyphonically with up to 24 voices (the default), or in mono mode. When voice-stealing is enabled, the oldest (longest-held) voice is stolen first. 

Portamento applies to pitch and velocity in mono mode, but also polyphonically when the special `Poly portamento mode` is enabled.

##### Poly portamento mode

Enable voice sliding in a polyphonic context by:

1. Enabling `Poly portamento mode` (make sure `Mono mode` is off), and
2. Reducing the number of voices.

When a voice is stolen (and only then), the stolen voice slides to the destination note instead of being silenced.

Poly portamento mode implements heuristic voice-leading, so the rules for voice stealing are slightly different. When a new note occurs and all available voices are in use, those that have been released (finger no longer on key, but note amp envelope still in release) are checked first, and the *nearest one* in terms of pitch is used. If all of the voices in use are still being held, then the nearest one of *those* is used.

#### Presets

Synth settings can be saved in a preset file, which has the `.jsynth` file extension. You can open a preset in two ways:

1. With <kbd>C-o</kbd> (standard `Open file`)
2. By opening the synth with <kbd>S-s</kbd>, navigating to the `Presets` tab, and selecting `Open preset`

When you open a new preset, it will override all of the current synth settings -- but you can undo and redo this action, so nothing will be lost.

  You can save the current preset by navigating to the `Presets` tab and selecting `Save preset as...`
  
### QWERTY piano emulator

Jackdaw provides the QWERTY piano emulator as a way for you to play the synth or otherwise record MIDI without an external MIDI controller. You can activate it with the `Activate QWERTY piano` command, which is bound to <kbd>S-q</kbd>. Deactivate with the same (<kbd>S-q</kbd>) or with <kbd>\<esc\></kbd>.

If you want to record MIDI data using the QWERTY piano, set the track input accordingly, and then hit <kbd>r</kbd> to record. You cannot stop recording with <kbd>r</kbd> like usual (it is too easy to do this accidentally), but escaping with <kbd>S-q</kbd> or <kbd>\<esc\></kbd> does the job.

### Piano roll

The piano roll view can be used to edit or create new MIDI clips.

To enter the view, use `Edit clip at cursor / open piano roll`, which is bound to <kbd>C-S-e</kbd>. If the [cursor](#cursor) is over a MIDI clip, that clip is opened in the piano roll; otherwise, a new clip is created.

The piano roll controls are designed to be analogous or identical to timeline controls. Notes in the piano roll view are analogous to clips in the timeline view. 

#### Navigation

All of these are exactly the same as in the timeline view: <kbd>j</kbd>, <kbd>k</kbd>, <kbd>l</kbd> for rewind/pause/play, <kbd>,</kbd> and <kbd>.</kbd> to zoom, <kbd>h</kbd> and <kbd>;</kbd> to move the view left and right, <kbd>[</kbd> and <kbd>]</kbd> to move the playhead (without playback), etc. 

If there is a grid enabled (a click track is positioned somewhere above the current track), then all of the bars/beats navigation commands work the same as well: <kbd>C-j</kbd> and <kbd>C-l</kbd> to go to the previous/next beat, <kbd>C-S-j</kbd> and <kbd>C-S-l</kbd> to go the the previous/next subdivision, and <kbd>A-S-j</kbd> and <kbd>A-S-l</kbd> to move to the previous/next measure.

In timeline view, <kbd>S-j</kbd> and <kbd>S-l</kbd> move the cursor to the previous/next *clip* boundary; in piano roll view, these commands (`Go to previous note`, `Go to next note`) move the cursor to the previous/next *note* boundary.

<img width="80%" src="https://jackdaw-audio.net/static/sync_gifs/piano_roll_nav.gif">

#### Note insertion (manual)

(NOTE: It is usually much faster to [insert notes with a MIDI device](#note-insertion-with-midi-device), including the builtin QWERTY piano emulator).

The "note selector" can be moved up and down with <kbd>n</kbd> and <kbd>p</kbd> (or <kbd>d</kbd> and <kbd>f</kbd>) just like the track selector. 

Hit <kbd>\<ret\></kbd> to insert a note at the current position. You will hear the note played back (at an arbitrary short duration) through the track's synth.

Hit <kbd>\<spc\></kbd> to insert a rest.

If you make a mistake, hit <kbd>\<del\></kbd> (or the backspace key) to "undo" it.

The duration of the next note (or rest) to be inserted is adjusted with `1` and `2`; velocity with `c` and `v`.

By default, the cursor (playhead) jumps the right edge of the inserted note. You can prevent this by enabling "chord mode" (<kbd>S-h</kbd>). Disabling chord mode then moves the cursor forward to the end of the chord (or the shortest note in the chord, if they have different durations).

"Tie mode" extends the last-inserted note instead of inserting a new one, provided that the playhead is still positioned at the of the last note, and the new insertion is on the same actual note (pitch) or notes (chord). So you can achieve, e.g., a dotted quarter by setting an eighth note duration, enabling tie mode, and hitting <kbd>\<ret\></kbd> three times.

(The only time you would *not* want tie mode is enabled is if you want to restrike notes immediately upon release.)


#### Note insertion (with MIDI device)

When the track input is set to a connected MIDI device OR when the QWERTY piano emulator is active, notes can be inserted simply by striking the keys of the device. Velocity and pitch are determined by the note you play, not by the piano roll input controls. Chords are detected (keystrokes occur within ~60ms of one another) and inserted as such.

Duration is still set with `1` and `2`, and rests are still inserted with <kbd>\<spc\></kbd>. <kbd>\<del\></kbd> (backspace) is the same.

"Tie mode" works exactly the same. (So does "Chord mode," though I can think of no reason to use it here.)

<img width="80%" src="https://jackdaw-audio.net/static/sync_gifs/piano_roll_insertion.gif">

#### Grabbing and moving notes

**Notes can be grabbed, moved, truncated, and extended exactly like clips**. That means all of the edge grabbing behavior described above for clips applies here as well.

<img width="80%" src="https://jackdaw-audio.net/static/sync_gifs/drag_note.gif">

You can also grab notes with the mouse by Cmd- or Ctrl- clicking the screen and dragging a box around the notes:

<img width="80%" src="https://jackdaw-audio.net/static/sync_gifs/piano_roll_grab_with_mouse.gif">

### Quantization

In the piano roll view, or timeline view with a MIDI clip under the cursor, use `Quantize notes (clip at cursor)` -- <kbd>A-q</kbd> -- to quantize the notes. You can set an `Amount`; an amount of 1.0 places the affected notes exactly on the gridlines (fully quantized), whereas an amount <1.0 will simply move them closer to those gridlines. This can serve as a quick and dirty way to clean up a performance without making it sound completely robotic. When `Quantize note offs` is unchecked, each note retains its original duration.

When notes have been quantized, their original positions will be shown by an empty grey box in the piano roll view. 

You can adjust the quantization amount after the notes have been quantized with `Adjust quantize amount`, <kbd>A-S-q</kbd>. This will only apply to notes that have already been quantized.

> [!NOTE] If you move a note or clip after it has been quantized, and then adjust the quantization amount without re-quantizing, information about the note or clip move will be lost. Adjusting the quantize amount always refers back to the position the notes were in when they were originally quantized.

### MIDI controllers

You can use the physical controllers (knobs, sliders) on your MIDI controller to control synth parameters. With the synth tabview open, simply select a slider (<kbd>\<tab\></kbd> to move the selection forward, <kbd>S-\<tab\></kbd> to move back, or just click the slider), and then turn the knob on your keyboard. This will automatically bind that physical controller to that slider in Jackdaw.

If you want to un-bind the controller, you can do so by holding down the `Alt` or `Option` key (<kbd>A-</kbd>)and turning the physical knob again.

This is a brand new feature and has not been thoroughly tested.

### MIDI files

> [!NOTE] This feature is a bit of a mess and has not been thoroughly tested. Use with caution.

Jackdaw can read MIDI files (`.mid` or `.midi`). 

You can open a MIDI file exactly like you would a .wav or .jdaw file (<kbd>C-o</kbd>, on the command line at start time, or drag-and-drop). If the number of tracks in the file exceeds what you have on your timeline, Jackdaw will ask if you want to add more tracks.

#### JLily (LilyPond)

[LilyPond](https://lilypond.org/) is a fantastic music engraving software and markup language. Jackdaw can parse a very limited (and slightly altered) subset of the language as a way to create new MIDI clips, called JLily.

JLily uses relative mode by default, with middle C as the starting reference pitch.

This feature actually has a short [video demo](https://www.youtube.com/watch?v=Zp8o8q8fw9o).

Supported syntax:
<pre>
   - note names
       e.g.        "c g g a g"
	   
   - duration
       e.g.        "c4 g8 g a g"
	   
   - dotted duration
       e.g.        "c4 g8. g16 a4 g"
	   
   - accidentals
       e.g.        "c4 g8. g16 aes4 g"
	   
   - rests
       e.g.        "c4 g8. g16 aes4 g r b c"
	   
   - octave indicators
       e.g.        "c4 g8. g16 aes4 g r b c c,"
	   
   - repeats
       e.g.        "\repeat 4 { c16, c' }"
                    (repeat ^ times)
					
   - nested repeats
       e.g.        "\repeat 16 { \repeat 4 {c, c'} \repeat 4 {g, g'} }"
	   
   - set velocity (JLILY ONLY, not standard lilypond)
       e.g.        "\velocity 100 c c e g \velocity 90 g e c"
	   
</pre>

## Undo / redo

Jackdaw retains a 100-event long history of user events. Generally, any changes to the project state -- those that would affect the saved `.jdaw` file -- can be undone. Actions that only affect the superficial state of the program cannot.

Objects that you delete will not be permanently deleted until the program is closed or the deletion event drops off the end of the event history.

Jackdaw undo is *linear.* That means that if you undo some number of changes, and then make a new change, you will lose the ability to redo those previously-undone events.

<kbd>C-z</kbd> : **undo**<br>
<kbd>C-y</kbd> / <kbd>C-S-z</kbd> : **redo**<br>

## Special audio inputs

Jackdaw will have access to all of the audio devices (speakers, microphones, etc.) that your system knows about. In addition, there are two special audio inputs that you can use to record audio onto a track.

### Jackdaw out

Jackdaw is capable of using its own audio output as an audio input. This makes it very easy to create mixdowns on-the-go, or to record some of the fun sounds you can make by scrubbing through your timeline and [dynamically adjusting the playback speed](#dynamic-playback-speed-adjustment).

### Pure data

> [!NOTE]
> This is an experimental feature and is not yet reliable.

<img src="https://jackdaw-audio.net/static/sync_gifs/pd_jackdaw.png"/>

[Pure data](https://puredata.info/) (often "Pd") is a graphical audio programming environment developed by Miller Puckette. It is very similar to Max, which was also developed by Puckette, but unlike Max, is free to download and use. Pure data can be used to create things like synthesizers and drum machines, as well as sound production programs that are too unusual to be designated as such.

Pd also provides a method for writing your own objects (called "externals") for use in the program. Jackdaw is capable of communicating with (and receiving audio from) Pd by means of an external called `pd_jackdaw~`. This external needs to be built and loaded into Pd. 

I have provided the source code for `pd_jackdaw~` here (`pd_jackdaw/pd_jackdaw.c`), but have not yet provided the means to build it or load it into Pd. If you are so inclined, you may figure out how to do this using [pd-lib-builder](https://github.com/pure-data/pd-lib-builder).

The `pd_jackdaw~` objects inlets are for the left and right channels of audio. If jackdaw is open and a `pd_jackdaw~` object is created, the two programs will do a handshake (exchange a series of signals) before setting up a block of shared memory, which they use to exchange audio data. If DSP is enabled in Pd and a track input is set to "Pure data" in jackdaw, you should be able to record audio directly from Pd just as you would from a microphone.

## API

> [!NOTE]
> This is an experimental feature and will be developed further in future versions of jackdaw.

Jackdaw can run a UDP server to allow external programs (pure data, for instance, or your own programs) to modify project parameters like the volume on a given track, or a filter effect's cutoff frequency.

### Starting the server

<kbd>C-S-p</kbd> : **Start API server**<br>

You will be prompted to select a port number. If the port is in use or otherwise invalid, an error message will appear at the bottom-right part of the screen. If there is no error, you can assume that the server is currently running on the selected port.

### Request syntax

Requests must be ASCII strings that follow the general format:
```
<route> <value>
``` 

The `<route>` parameter describes a path to the desired parameter. Global parameters like the playback speed are identified at the top level, i.e. `/play_speed`. Parameters related to tracks must be routed through the timeline, then the track, each by name, and finally the name of the parameter. 

So if you want to access the volume parameter on a track called "Synth" on a timeline called "Main" (the default), the route would be:

```
/main/synth/vol
```

Note that uppercase characters in the names are lowered. Non-alphanumeric characters are replaced with an underscore. 

Here are some example requests:

`/main/track_1/pan 0.2`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--> set pan on track 1 to 0.2 (0.0 == L, 1.0 = R)

`/scratch_pad/kick/fir_filter/freq 0.2`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--> on the "scratch pad" timeline, set the "kick" track filter cutoff freq to 2% of nyquist (range 0.0 -> 1.0)


`/main/lead_synth/delay/len 600`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--> set the delay line effect time to 600ms


The currently-available endpoints are, generically:

```
/play_speed
/<timeline name>/<track name>/vol
/<timeline name>/<track name>/pan
/<timeline name>/<track name>/<effect name>/[<effect substructure>/]<effect parameter name>
```

You can print a list of available routes to the console with the `api_print_all_routes` command (accessible via menus or function lookup).

Example output:

```
/play_speed
/main/track_1/vol
/main/track_1/pan
/main/track_1/delay/delay_line_len
/main/track_1/delay/delay_line_amp
/main/track_1/delay/delay_line_stereo_offset
/main/track_1/delay/active
/main/track_1/delay_2/delay_line_len
/main/track_1/delay_2/delay_line_amp
/main/track_1/delay_2/delay_line_stereo_offset
/main/track_1/delay_2/active
/main/track_1/compressor/attack_time
/main/track_1/compressor/release_time
/main/track_1/compressor/threshold
/main/track_1/compressor/ratio
/main/track_1/compressor/makeup_gain
/main/track_1/compressor/active
/main/synth/vol
/main/synth/pan
/main/synth/equalizer/active
/main/synth/equalizer/filter_1/freq
/main/synth/equalizer/filter_1/amp
/main/synth/equalizer/filter_1/bandwidth_preferred
/main/synth/equalizer/filter_2/freq
/main/synth/equalizer/filter_2/amp
/main/synth/equalizer/filter_2/bandwidth_preferred
/main/synth/equalizer/filter_3/freq
/main/synth/equalizer/filter_3/amp
/main/synth/equalizer/filter_3/bandwidth_preferred
/main/synth/equalizer/filter_4/freq
/main/synth/equalizer/filter_4/amp
/main/synth/equalizer/filter_4/bandwidth_preferred
/main/synth/equalizer/filter_5/freq
/main/synth/equalizer/filter_5/amp
/main/synth/equalizer/filter_5/bandwidth_preferred
/main/synth/equalizer/filter_6/freq
/main/synth/equalizer/filter_6/amp
/main/synth/equalizer/filter_6/bandwidth_preferred
```

Most applications for the API will involve sending UDP messages over localhost, but messages can also be sent over a network. 

# Command reference
### global mode
- Summon menu : <kbd>C-m</kbd>, <kbd>C-h</kbd>
- Escape : <kbd>\<esc\></kbd>
- Quit : <kbd>C-q</kbd>
- Undo : <kbd>C-z</kbd>
- Redo : <kbd>C-y</kbd>, <kbd>C-S-z</kbd>
- Show output spectrum : <kbd></kbd>
- Save Project : <kbd>C-s</kbd>
- Open file (.wav or .jdaw) : <kbd>C-o</kbd>
- Start API server : <kbd>C-S-p</kbd>
- Function lookup : <kbd>\<spc\></kbd>
- Chaotic user test (debug only) : <kbd>A-S-\<del\></kbd>
- Print all API routes : <kbd></kbd>
### menu_nav mode
- Next item : <kbd>n</kbd>, <kbd>f</kbd>
- Previous item : <kbd>p</kbd>, <kbd>d</kbd>
- Next section : <kbd>C-n</kbd>, <kbd>C-f</kbd>, <kbd>C-\<up\></kbd>
- Previous section : <kbd>C-p</kbd>, <kbd>C-d</kbd>, <kbd>C-\<down\></kbd>
- Choose item : <kbd>\<ret\></kbd>, <kbd>k</kbd>
- Column right : <kbd>l</kbd>
- Column left : <kbd>j</kbd>
- Move menu up : <kbd>\<up\></kbd>
- Move menu down : <kbd>\<down\></kbd>
- Move menu right : <kbd>\<right\></kbd>
- Move menu left : <kbd>\<left\></kbd>
- go back (dismiss) : <kbd>\<del\></kbd>, <kbd>m</kbd>, <kbd>h</kbd>, <kbd>\<esc\></kbd>, <kbd>g</kbd>
### timeline mode
#### Playback / Record
- Play : <kbd>l</kbd>, <kbd>e</kbd>
- Pause : <kbd>k</kbd>, <kbd>w</kbd>, <kbd>S-k</kbd>
- Rewind : <kbd>j</kbd>, <kbd>q</kbd>
- Play slow : <kbd>k-l</kbd>
- Rewind slow : <kbd>k-j</kbd>
- Move playhead left : <kbd>[</kbd>
- Move playhead right : <kbd>]</kbd>
- Move playhead left (slow) : <kbd>S-[</kbd>
- Move playhead right (slow) : <kbd>S-]</kbd>
- Nudge play position left (500 samples) : <kbd>\<left\></kbd>
- Nudge play position right (500 samples) : <kbd>\<right\></kbd>
- Nudge play position left (100 samples) : <kbd>S-\<left\></kbd>
- Nudge play position right (100 samples) : <kbd>S-\<right\></kbd>
- Move one sample left : <kbd>C-S-\<left\></kbd>
- Move one sample right : <kbd>C-S-\<right\></kbd>
- Record (start or stop) : <kbd>r</kbd>
#### Timeline navigation
- Previous track (move selector up) : <kbd>p</kbd>, <kbd>\<up\></kbd>, <kbd>d</kbd>
- Next track (move selector down) : <kbd>n</kbd>, <kbd>\<down\></kbd>, <kbd>f</kbd>
- Toggle automation read : <kbd>S-r</kbd>
- Move selected track down : <kbd>S-n</kbd>, <kbd>S-f</kbd>
- Move selected track up : <kbd>S-p</kbd>, <kbd>S-d</kbd>
- Minimize selected track(s) : <kbd>-</kbd>
- Move view right : <kbd>;</kbd>
- Move view left : <kbd>h</kbd>
- Zoom out : <kbd>,</kbd>
- Zoom in : <kbd>.</kbd>
#### Marks
- Set In : <kbd>i</kbd>
- Set Out : <kbd>o</kbd>
- Go to In : <kbd>S-i</kbd>
- Go to Out : <kbd>S-o</kbd>
- Go to t=0 : <kbd>S-u</kbd>
- Go to previous clip boundary : <kbd>S-j</kbd>
- Go to next clip boundary : <kbd>S-l</kbd>
- Go to next beat : <kbd>C-l</kbd>
- Go to previous beat : <kbd>C-j</kbd>
- Go to next subdiv : <kbd>C-S-l</kbd>
- Go to previous subdiv : <kbd>C-S-j</kbd>
- Go to next measure : <kbd>A-S-l</kbd>
- Go to previous measure : <kbd>A-S-j</kbd>
- Bring rear clip at cursor to front : <kbd>S-z</kbd>
- Toggle loop playback : <kbd>C-8</kbd>
#### Output
- Set default audio output : <kbd>C-S-o</kbd>
#### Tracks
- Add Track : <kbd>C-t</kbd>
- Activate/deactivate selected track : <kbd>\<ret\></kbd>
- Activate/deactivate all tracks : <kbd>`</kbd>
- Delete selected track or automation : <kbd>C-\<del\></kbd>
- Activate track 1 : <kbd>1</kbd>
- Activate track 2 : <kbd>2</kbd>
- Activate track 3 : <kbd>3</kbd>
- Activate track 4 : <kbd>4</kbd>
- Activate track 5 : <kbd>5</kbd>
- Activate track 6 : <kbd>6</kbd>
- Activate track 7 : <kbd>7</kbd>
- Activate track 8 : <kbd>8</kbd>
- Activate track 9 : <kbd>9</kbd>
#### Click tracks
- Add click track : <kbd>C-S-t</kbd>
- Set tempo at cursor : <kbd>t</kbd>
#### Track settings
- Add effect to track : <kbd>S-e</kbd>
- Open track settings : <kbd>S-t</kbd>
- Mute or unmute selected track(s) : <kbd>m</kbd>
- Solo or unsolo selected track(s) : <kbd>s</kbd>
- Track volume up : <kbd>S-=</kbd>
- Track volume down : <kbd>S--</kbd>
- Track pan left : <kbd>S-9</kbd>
- Track pan right : <kbd>S-0</kbd>
- Rename selected track : <kbd>C-r</kbd>
- Set track input : <kbd>C-S-i</kbd>
- Show or hide all track automations : <kbd>a</kbd>
- Add automation to track : <kbd>C-a</kbd>
#### Clips
- Grab clip at cursor : <kbd>g</kbd>
- Grab clips in marked range : <kbd>S-g</kbd>
- Copy grabbed clips : <kbd>C-c</kbd>
- Paste grabbed clips : <kbd>C-v</kbd>
- Start or stop dragging clips : <kbd>C-k</kbd>
- Cut : <kbd>S-c</kbd>
- Split stereo clip at cursor to mono : <kbd></kbd>
- Rename clip at cursor : <kbd>C-S-r</kbd>
- Delete : <kbd>\<del\></kbd>
#### Sample mode
- Load clip at cursor to source : <kbd>C-1</kbd>
- Activate Source Mode : <kbd>S-1</kbd>
- Drop clip from source : <kbd>b</kbd>
- Drop previously dropped clip (1) : <kbd>v</kbd>
- Drop previously dropped clip (2) : <kbd>c</kbd>
- Drop previously dropped clip (3) : <kbd>x</kbd>
- Drop previously dropped clip (4) : <kbd>z</kbd>
#### Multiple timelines
- Add new timeline : <kbd>A-t</kbd>
- Previous timeline : <kbd>A-j</kbd>
- Next timeline : <kbd>A-l</kbd>
- Delete timeline : <kbd>A-\<del\></kbd>
#### Export
- Write mixdown to .wav file : <kbd>C-e</kbd>, <kbd>S-w</kbd>
### source mode
- Play (source) : <kbd>l</kbd>
- Pause (source) : <kbd>k</kbd>, <kbd>S-k</kbd>
- Rewind (source) : <kbd>j</kbd>
- Play slow (source) : <kbd>S-l</kbd>, <kbd>k-l</kbd>
- Rewind slow (source : <kbd>S-j</kbd>, <kbd>k-j</kbd>
- Set In Mark (source) : <kbd>i</kbd>, <kbd>S-i</kbd>
- Set Out Mark (source) : <kbd>o</kbd>, <kbd>S-o</kbd>
### modal mode
- Go to next item : <kbd>n</kbd>, <kbd>f</kbd>, <kbd>\<down\></kbd>
- Go to previous item : <kbd>p</kbd>, <kbd>d</kbd>, <kbd>\<up\></kbd>
- Go to next item (escape DirNav) : <kbd>\<tab\></kbd>, <kbd>S-n</kbd>, <kbd>S-f</kbd>, <kbd>S-\<down\></kbd>
- Go to previous item (escape DirNav) : <kbd>S-\<tab\></kbd>, <kbd>S-p</kbd>, <kbd>S-d</kbd>, <kbd>S-\<up\></kbd>
- Select item : <kbd>\<ret\></kbd>
- Dismiss modal window : <kbd>m</kbd>, <kbd>h</kbd>, <kbd>g</kbd>, <kbd>\<esc\></kbd>
- Submit form : <kbd>C-\<ret\></kbd>
### text_edit mode
- Escape text edit : <kbd>\<ret\></kbd>, <kbd>\<tab\></kbd>, <kbd>S-\<tab\></kbd>
- Escape text edit : <kbd>\<esc\></kbd>
- Backspace : <kbd>\<del\></kbd>
- Move cursor right : <kbd>\<right\></kbd>, <kbd>C-f</kbd>
- Move cursor left : <kbd>\<left\></kbd>, <kbd>C-d</kbd>, <kbd>C-b</kbd>
- Select all : <kbd>C-a</kbd>
### tabview mode
- Next element : <kbd>S-n</kbd>, <kbd>S-\<down\></kbd>, <kbd>S-f</kbd>, <kbd>\<tab\></kbd>
- Previous element : <kbd>S-p</kbd>, <kbd>S-\<up\></kbd>, <kbd>S-d</kbd>, <kbd>S-\<tab\></kbd>
- Select : <kbd>\<ret\></kbd>
- Move left : <kbd>h</kbd>
- Move right : <kbd>;</kbd>
- Next tab : <kbd>S-l</kbd>, <kbd>S-;</kbd>
- Previous tab : <kbd>S-j</kbd>, <kbd>S-h</kbd>
- Move current tab left : <kbd>C-S-j</kbd>, <kbd>C-S-h</kbd>
- Move current tab right : <kbd>C-S-l</kbd>, <kbd>C-S-;</kbd>
- Close tab view : <kbd>g</kbd>, <kbd>\<esc\></kbd>
### autocomplete_list mode
- Next item : <kbd>\<tab\></kbd>, <kbd>\<down\></kbd>, <kbd>C-n</kbd>
- Previous item : <kbd>S-\<tab\></kbd>, <kbd>\<up\></kbd>, <kbd>C-p</kbd>
- Select item : <kbd>\<ret\></kbd>
- Escape autocomplete list : <kbd>\<esc\></kbd>

...

[ LAST UPDATED 2025-05-21 WEDNESDAY ]

...
